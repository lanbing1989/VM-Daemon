# 守护进程（日志监控+自动重启+VM Code 提取+目录记忆）

## 简介

本软件为 Windows 平台下的守护进程管理工具，具备以下功能：

- **自动监控日志**：实时监控指定目录下的日志文件（log.txt），当出现 `[Error] Cannot send message. Client is not connected to the server.` 异常三次时，自动重启被控端程序。
- **自动清理同名进程**：重启前自动杀死所有同名 exe，避免多实例冲突。
- **VM Code 提取与复制**：自动识别日志中 `[Info] Your code to connect VM: XXXXXXX`，并在界面上显示 VM Code，支持一键复制。
- **记忆文件夹路径**：首次选择被控端 exe 所在文件夹后自动保存，下次启动自动恢复，无需再次选择。
- **简洁易用的 GUI 界面**：提供启动、重启、停止等一站式管理，状态与日志实时展示。
- **自带公司版权信息**。

## 使用方法

### 1. 运行环境

- Windows 7/10/11，建议 64 位
- 无需手动安装 Python，直接使用 exe 可执行文件即可

### 2. 启动步骤

1. **首次运行**  
   双击 `daemon_guard.exe`。  
   第一次需点击“选择文件夹”选择被控端 exe 所在目录（该目录下应有被控端 exe 文件和 log.txt）。

2. **启动守护**  
   点击“启动”按钮，守护程序会自动查找最新的 exe 并运行，同时监控 log.txt 日志。

3. **自动重启逻辑**  
   当日志中 60 秒内出现三次 `[Error] Cannot send message. Client is not connected to the server.`，守护程序会自动重启被控端 exe。

4. **VM Code 提取**  
   程序会自动在界面下方显示日志中最新出现的 VM Code，点击“复制”按钮可一键复制该 code。

5. **下次启动自动记忆**  
   程序会自动记住上次的目录，无需再次手动选择。

6. **安全关闭**  
   直接点右上角“X”关闭窗口即可，程序会自动清理所有子进程并安全退出。

### 3. 其他功能

- **重启**：手动强制重启被控端 exe。
- **停止**：手动停止所有被控端 exe 实例。
- **自动生成 config.ini**：程序会自动生成和维护 config.ini 文件，无需手动修改。
- **日志内容实时滚动显示**。

### 4. 常见问题

- **无法关闭程序/关不掉**  
  已修复，最新版支持点击关闭按钮完全退出。
- **启动失败/找不到 exe**  
  请确认已正确选择包含 exe 和 log.txt 的文件夹。
- **杀毒误报**  
  因为是自定义打包，可能被部分安全软件误报为风险程序，可自行添加信任或白名单。

### 5. 打包说明（如需自行打包）

需先安装 Python 3.x 和依赖（psutil、tkinter 标准库自带），再用以下命令打包：

```bash
pip install pyinstaller
pyinstaller --onefile --noconsole daemon_guard.py
```

无需手动打包 config.ini，程序会自动生成。

---

## 界面示例

![软件界面截图](doc/screenshot.png)

---

## 版权信息

版权所有  灯火通明（济宁）网络有限公司

如有问题可联系技术支持。
